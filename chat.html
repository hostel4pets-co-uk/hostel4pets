<head>
    <link rel="stylesheet" href="./styles.css">
    <script src="chat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel4Pets Chat</title>
</head>

<body>
    <div class="chat-modal">
        <header class="chat-header">
            <div id="chat-controls">
                <div id="clear-btn" class="emoji-btn">✖️</div>
                <div id="collapse-btn" class="emoji-btn">➖</div>
            </div>
        </header>

        <main class="chat-body">
            <!-- Chat history (JS will insert messages here) -->
            <div id="chatroom"></div>

            <!-- Fixed-height input box -->
            <textarea id="message" placeholder="Type your message here"></textarea>
        </main>

        <footer class="chat-footer">
            <!-- Nickname input and Submit button (shown only when no session) -->
            <input type="text" id="nickname" placeholder="Enter your nickname" hidden />
            <button id="submit-button" hidden>Submit</button>

            <!-- Send button (hidden when nickname not set) -->
            <button id="send-button">Send</button>
        </footer>
    </div>

    <script>
        async function openChatPanel() {
            if (document.getElementById("chat-panel-shell")) return;

            const shell = document.createElement("div");
            shell.id = "chat-panel-shell";
            shell.style.position = "fixed";
            shell.style.bottom = "0";
            shell.style.right = "0";
            shell.style.width = "300px";
            shell.style.height = "400px";
            shell.style.zIndex = "2000";
            shell.style.display = "flex";
            shell.style.flexDirection = "column";
            shell.style.overflow = "hidden";
            shell.style.background = "transparent"; // let chat.html drive styling

            let html = "";
            try {
                const resp = await fetch("./chat.html");
                if (!resp.ok) throw new Error("Failed to load chat.html");
                html = await resp.text();
            } catch (err) {
                console.error("❌ Error loading chat content:", err);
                html = `<div><p>Could not load chat.html</p></div>`;
            }

            const tmp = document.createElement("div");
            tmp.innerHTML = html;
            const backbone = tmp.querySelector(".chat-modal") || tmp.firstElementChild;
            if (backbone) {
                backbone.style.display = "flex";
                shell.appendChild(backbone);
            } else {
                shell.innerHTML = html;
            }

            document.body.appendChild(shell);
        }

        openChatPanel();
    </script>
</body>